# 源代码管理规范
###### version: 1.0
###### author:  MagicNana999@gmail.com
###### date: 2021年8月11日


### 1 总则
本公司所有项目的源代码，都必须使用 Git 管理，git 服务器：xxxx.xxx.xxx。


### 2 GitFlow
> https://zhuanlan.zhihu.com/p/66048537

##### 2.1 Master 和 Main
* Master 和 Main 都是主干分支，只能存在一个，不能既存在 Master 又存在 Main，以下统称为 Master。<br>
(受西方白左风潮影响，某些 Git 服务把原来的 Master 分支更名为 Main，声称 master 暗喻白人奴隶主。)

* 当前生产环境的代码和 Master 相同。过往的生产环境版本的代码在相应的 Release 中，后续有介绍。

* Master 禁止提交，只能 merge。

* Master上的代码都是经过测试的稳定版本。

##### 2.2 Develop 和 Dev
* Develop（同 Dev，下文简称 Dev）是生产环境的最新代码 + 可能存在的，某些修改的未上线的内容。

* Dev 是整个 GitFlow 中最复杂的分支，是 Feat，Release，Fix 的起点。

* Dev 可以有限的Commit，在提交之前，必须和 Git 管理员口头申请。

##### 2.3 Feat
* 为开发某些新需求而创建。必须从 Dev 上创建，可以提交到 Remote，也可以不提交到 Remote。

##### 2.4 Release
* Release 分支用于保存某一个发布版本。

* Release 分支从 Dev 创建。

* Release 测试 上线 成功后，需要合并到 Master。

##### 2.5 Fix
* 为了修复线上的 Bug 而创建。

* 一般来讲，线上的代码都是经过测试和验收的稳定版本，但是不排除有可能需要修改。此时需要在相应的 Release 分支上创建 Fix 分支。

##### 2.6 其他。
其他分支根据实际需要管理，比如备份。


### 3 GitFlow 实例。
* 项目创建时只有 Master
* 第一个需求（login）的开发版本，从 Master 创建 Dev。在Dev 上创建分支 Feat-login
* 开发 login 需求，持续进行中。
* 在 login 需求未开发完毕的情况下，在 Dev 上可以做修改，比如：修改页面上的文字，在保证影响范围的情况下，可以直接修改，并且提交。
* 在 Login 需求未开发完毕的情况下，有新需求 Logout 需要同步完成。
* 评估 Login 需求和 Logout 需求是否要求同时上线，或有可能先后上线。
* 如果有可能先后上线就在 Dev 上新建 Feat-Logout，否则可以在 Feat-Login 上开发。
* 假设存在 Feat-Logout分支。开发团队在此分支上编码。
* Feat-Login开发完成后，合并 Feat-Login到 Dev，把 Dev 部署到测试环境测试。此时 Dev 禁止任何提交和 merge。
* 测试过程中，如果有其他Feat 合并到 Dev，此时需要重新开始测试。
* 测试完毕后，基于 Dev 分支创建 Release-1.0 分支，并且修改 Release.note。 上线、测试、验收。
* 上线完毕后，合并 Release-1.0 到 Master和 Dev。
* 删除已上线的 Feat 分支。
* 上线后需要修改时，需要在Release-1.0 分支上，创建分支 Fix-1.1，修改代码，测试部署。
* Fix-1.1 上线后，创建新的分支 Release-1.1，并且合并到 Master 和 Dev。


### 4 Git Commit 规范
> https://www.jianshu.com/p/201bd81e7dc9?utm_source=oschina-app

```markdown
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```
header 必须。<br>
body   可选。<br>
footer 可选。<br>

##### 4.1 Header 中的 Type

用于说明git commit的类别，只允许使用下面的标识。

* feat：新功能（feature）。
* fix：产生diff并自动修复此问题。适合于一次提交直接修复问题
* docs：文档（documentation）。
* style：格式（不影响代码运行的变动，比如格式化）。
* refactor：重构（即不是新增功能，也不是修改bug的代码变动）。
* perf：优化相关，比如提升性能、体验。
* test：增加测试。
* build：构建过程或辅助工具的变动。
* revert：回滚到上一个版本。
* merge：代码合并。

##### 4.2 Header 中的 Scope
可以是 Module，也可以是 Controller，或者 *

##### 4.3 Header 中的subject
subject是commit目的的简短描述，不超过50个字符。必须写中文。结尾没有句号。


##### 4.4 Body
body 用于详细描述此次提交，注意有空行。

##### 4.5 Footer
* 当本次修改引起了不兼容的变动，以BREAKING CHANGE开头，之后是变动的描述，理由和迁移方法等。
* 关闭Issue Close #1213（href）

### 5 Java 编码规范
> https://google.github.io/styleguide/javaguide.html
> https://help.aliyun.com/document_detail/145927.html

Format
> https://github.com/google/styleguide/blob/gh-pages/intellij-java-google-style.xml


### 6 LiuYi-MS 规范。

* 缓存必须手工实现，类似于 MyBatis 的org.apache.ibatis.annotations.CacheNamespace 禁止使用。
* 如果用单机 redis，只能使用Database 0，其他库禁止使用。
* 服务端固定使用 Jedis 或者 lettuce 或者 RedisTemplate（Jedis）或者 RedisTemplate（Lettuce），但是不能有额外的引号。
* 方法名：查询缓存+数据库的以 find 开头。只查数据库的以 query 开头。
* 任何代码中禁止出现魔法值。
* 属于某个实体的枚举，要写到实体类内部。
* 数据库中禁止存储 Blob、Base64 的图片等大文件。
* 禁止使用SnowFlakeID。
* 所有实体、VO，对象必须从 AbstractObject 派生。
* 所有 Controller 存 AbstractController 派生。
* 所有 Service/Component从 AbstractService 派生。
* 日志（info、debug），必须有前置的 isDebugEnable/isInfoEnable
* 如果有不同的时区要求，DB 中存储 UTF+0，前端根据自己的时区（含夏令时）自己转换。
* 客户端与服务端的 HTTP 交互，必须先判断 HTTP Status，401 未认证，403 没有权限，400 业务错误 500 服务器内部错误、超时。只有在 HTTP Status 是 200 时，才能取得 Data
* 客户端与服务端的 TCP 和 UDP交互，另有私有协议说明。


### 7 VUE/html/JS  编码规范
> https://google.github.io/styleguide/htmlcssguide.html
> https://google.github.io/styleguide/jsguide.html
> https://github.com/vuejs/cn.vuejs.org/blob/master/src/v2/style-guide/index.md

Format 
> 使用 eslint

### 8 Android 编码规范
> https://google.github.io/styleguide/javaguide.html
> https://help.aliyun.com/document_detail/145927.html
> https://yq.aliyun.com/attachment/download/?id=5259

Format (Android Open Source Project Style)
> https://github.com/google/styleguide/blob/gh-pages/intellij-java-google-style.xml
  
### 9 iOS OC 编码规范
> https://google.github.io/styleguide/objcguide.html (内含 Apple 官方规范)

Format (具体配置在附录)
> CLangFormat

### 10 iOS swift 编码规范
> https://google.github.io/swift/ (内含 Apple 官方规范)

Format SwiftFormat
> https://github.com/nicklockwood/SwiftFormat/releases

